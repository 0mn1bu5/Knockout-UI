/*!
 * Knockout-UI v0.5.0
 * A home for rich UI components based on KnockoutJS
 * Copyright (c) 2013 Ian Mckay
 * https://github.com/madcapnmckay/Knockout-UI.git
 * License: MIT (http://opensource.org/licenses/mit-license.php)
**/
(function(){var logger=function(t){"undefined"!=typeof debug&&$("<div></div>").appendTo("#log").text((new Date).toGMTString()+" : "+t)},templateEngine=new ko.jqueryTmplTemplateEngine,Menu=function(t,e){this.viewModel=e,this.cssClass=ko.observable(t.cssClass||e.cssClass()),this.width=ko.observable(t.width||190),this.name=ko.observable(t.name);var i=this;this.items=ko.observableArray([]);for(var n in t.items){var s=t.items[n];this.items.push(new MenuItem(s,i))}},MenuItem=function(data,container){this.dataItem={},this.container=container,this.text=ko.observable(data.text||""),this.iconCssClass=ko.observable(data.iconCssClass||""),this.separator=ko.observable(data.separator||!1),this.run="function"==typeof data.run?data.run:eval(data.run),this.items=ko.observableArray(data.items||[]),this.width=ko.observable(container.width()),this.disabled=ko.observable(!1),void 0!==data.items&&data.items.length>0&&(this.subMenu=new Menu({items:data.items},container)),this.hasChildren=function(){return void 0!==this.subMenu}.bind(this),this.addDataItem=function(t){if(this.dataItem=t,this.hasChildren())for(var e=0;this.subMenu.items().length>e;e+=1)this.subMenu.items()[e].addDataItem(t)}.bind(this),this.itemWidth=function(){return(this.separator()?this.width()-4:this.width()-6)+"px"}.bind(this),this.labelWidth=function(){return this.width()-41+"px"}.bind(this),this.onClick=function(){return this.disabled()||void 0===this.run?!1:(this.run(this.dataItem),$(".ui-context").remove(),void 0)}.bind(this)};ko.contextMenu={viewModel:function(configuration){this.cssClass=ko.observable(configuration.cssClass||"ui-context"),this.build="function"==typeof configuration.build?configuration.build:eval(configuration.build);var self=this;this.contextMenus=ko.observableArray([]);for(var i in configuration.contextMenus){var menu=configuration.contextMenus[i];this.contextMenus.push(new Menu(menu,self))}}},ko.addTemplateSafe("contextItemTemplate",'					<li data-bind="subContext: hasChildren(), click : onClick, bubble : false, css : { separator : separator, disabled : disabled }, style : { width : itemWidth() }">						<span class="inner"><span class="icon ${iconCssClass}"></span><label data-bind="css : { parent : hasChildren() }, style : { width : labelWidth() }">							${ text }</label></span>						{{if hasChildren() }}							<div class="${ container.cssClass() } nocontext" style="position:absolute;" >								<ul data-bind=\'template: { name: "contextItemTemplate", foreach: subMenu.items }\'></ul>							</div>						{{/if}}					</li>',templateEngine),ko.addTemplateSafe("contextMenuTemplate",'					<div class="${ menu.cssClass() } ui-context nocontext" style="position:absolute;" data-bind="position: { width: menu.width(), of : mousePosition }, style : { zIndex : zIndex }">						<ul data-bind=\'template: { name: "contextItemTemplate", foreach: menu.items }\'></ul>					</div>',templateEngine),ko.bindingHandlers.contextMenu={init:function(t,e,i,n){var s,a,o,l,r=$(t),d=n,u=ko.utils.unwrapObservable(e());u.build,r.addClass("nocontext").mousedown(function(t){if(3===t.which){if(o=u.build(t,d),l=u.contextMenus().filter(function(t){return t.name()===o.name})[0],$(".ui-context").remove(),void 0!==l){o.menu=l,o.mousePosition=t,s=$("<div></div>").appendTo("body");for(var e=0;o.menu.items().length>e;e+=1)a=o.menu.items()[e],a.disabled(void 0!==o.disable&&-1!==o.disable.indexOf(a.text()));for(var i=0;o.menu.items().length>i;i+=1){var n=o.menu.items()[i];n.addDataItem(d)}var c=1;r.parents().each(function(){var t=$(this).css("zIndex");"auto"!==t&&(t=parseInt(t,10),t>c&&(c=t))}),o.zIndex=c,ko.renderTemplate("contextMenuTemplate",o,{templateEngine:templateEngine},s,"replaceNode")}return!1}}),$(".nocontext").live("contextmenu",function(){return!1}),$("html").click(function(){$(".ui-context").remove()})}},ko.bindingHandlers.subContext={init:function(t,e,i,n){var s,a=$(t),o=ko.utils.unwrapObservable(e());ko.utils.unwrapObservable(n.width()),o&&(s="."+n.container.cssClass(),$(s,a).hide(),a.hover(function(){var t=$(this);$(s,t).first().toggle().position({my:"left top",at:"right top",of:t,collision:"flip"})}))}},ko.bindingHandlers.position={init:function(t,e){var i=$(t),n=ko.utils.unwrapObservable(e()),s=ko.utils.unwrapObservable(n.width),a={my:n.my||"left top",at:n.at||"right",of:n.of,offset:n.offset||"0 0",collision:n.collision||"fit"};0===i.width()&&i.width(s),i.position(a)}}})();