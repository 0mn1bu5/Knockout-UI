<!doctype html>
<html lang="en">
<head>
<head>
	<meta charset="utf-8">
	<title>Knockout UI - Tree Demo</title>
	<link rel="stylesheet" href="../build/css/ui-tree.css" />
</head>
<body>
	<div data-bind="tree : tree" style="width: 300px;"></div>

	<button data-bind="click: rename, clickBubble: false">Rename</button>
	<button data-bind="click: add">Add</button>
	<button data-bind="click: remove">Remove</button>

	<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.0.min.js"></script>
	<script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.10.2/jquery-ui.min.js"></script>
	<script src="../node_modules/knockout-client/knockout.js"></script>
	<script  src="../src/js/ui-core.js"></script>
	<script  src="../src/js/ui-tree.js"></script>
	
	<script type="text/javascript">


		var ViewModel = function() {
			var self = this;

			this.tree = new ko.ui.Tree({
				nodes: [
					{ 
						id: 1, title: "Tom", 
						nodes : [ 
							{ id: 5, title: "Arnie" }, 
							{ id: 6, title: "Anders" }, 
							{ id: 7, title: "Apple" } 
						] 
					},
					{ 
						id: 2, title: "Dick", expanded: true, 
						nodes : [ 
							{ id: 8, title: "Boutros-Boutros"}, 
							{ id: 9, title: "Brianna" }, 
							{ id: 10, title: "Barbie" }, 
							{ id: 11, title: "Bee-bop", children: true } // children loaded on expand, needed for correct icon
						]
					},
					{ 
						id: 3, title: "Harry", type: 'widget'
					}
				]
			});
			// get (id) returns node
			// remove (idOrNode) 
			// add (nodeDef)

			this.tree.subscribe("click", function(event) {
				// event.node
				// return false cancels
				console.log("click " + event.node.toString());
			});

			this.tree.subscribe("context", function(event) {
				// event.node
				// return false cancels
				console.log("context " + event.node.title());
			});

			this.tree.subscribe("dblClick", function(event) {
				// event.node
				// return false cancels
				console.log("dblClick " + event.node.title());
			});

			this.tree.subscribe("toggle", function(event) {
				// event.node
				// return false cancels
				console.log("toggle " + event.node.title());
				return [{ id: ++id, title: "Ajax loaded child" }];
			});

			this.tree.subscribe("edit", function(event) {
				// event.node
				// return false cancels
				console.log("edit " + event.node.title());
			});

			this.tree.subscribe("renamed", function(event) {
				// event.node
				// event.oldName
				// event.newName
				// return false cancels
				// return promise 
				console.log("renamed " + event.from + " to "  + event.to);
			});

			this.tree.subscribe("moved", function(event) {
				// event.node-
				// event.to
				// return false cancels
				// return promise
				console.log("moved " + event.node.toString() + " to " + event.to.toString());
			});

			var id = 11;
			this.tree.subscribe("added", function(event) {
				// event.parent
				// event.node

				// return false cancels
				// return promise
				// return node
				for (var i = 0; i < event.nodes.length; i += 1) {
					console.log("added " + event.nodes[i].title);
				}		
				return ko.utils.arrayMap(event.nodes, function(el) {
					return { id: ++id, title: el.title };
				});
			});

			this.tree.subscribe("removed", function(event) {
				// event.node
				// return false cancels
				// resturn promise
				// return node
				for (var i =0; i < event.nodes.length; i += 1) {
					console.log("removed " + event.nodes[i].title());	
				}
			});
			
			this.rename = function() {
				self.tree.edit();
				return false;
			};

			this.add = function() {
				self.tree.add();
			};

			this.remove = function() {
				self.tree.remove();
			};
			
		};
		var vm = new ViewModel();
		
		$(function () {
			ko.applyBindings(vm);
		});
	</script>
</body>
</html>